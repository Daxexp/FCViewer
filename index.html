<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transaction Pie Chart</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .amount-income {
      color: green;
    }
    .amount-expense {
      color: red;
    }
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="loading">Loading...</div>

  <h2>Transactions</h2>
  <select id="categoryFilter">
    <option value="">All</option>
  </select>

  <div id="piechart" style="width: 700px; height: 400px;"></div>
  <table id="transactionTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Category</th>
        <th>Amount (Rs.)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // Loading screen fade-out animation
    window.addEventListener('load', () => {
      const loading = document.getElementById('loading');
      loading.style.transition = 'opacity 0.8s ease';
      loading.style.opacity = 0;
      setTimeout(() => loading.style.display = 'none', 800);
    });

    const transactions = [
      { date: '2025-07-21', description: 'Salary', category: 'Income', amount: 10000 },
      { date: '2025-07-20', description: 'Lunch', category: 'Food', amount: 500 },
      { date: '2025-07-19', description: 'Bus Ticket', category: 'Transportation', amount: 100 },
      { date: '2025-07-18', description: 'Internet Bill', category: 'Payments Mobile&Data', amount: 1200 },
      { date: '2025-07-17', description: 'House Rent', category: 'Housing/Board', amount: 7500 }
    ];

    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function getCategoryColor(category) {
      return category === 'Income' ? 'amount-income' : 'amount-expense';
    }

    function formatDateString(dateString) {
      const date = new Date(dateString);
      const day = date.getDate();
      const weekday = date.toLocaleDateString('en-US', { weekday: 'short' });

      const suffix = (d) => {
        if (d > 3 && d < 21) return 'th';
        switch (d % 10) {
          case 1: return 'st';
          case 2: return 'nd';
          case 3: return 'rd';
          default: return 'th';
        }
      };

      return `${day}${suffix(day)} ${weekday}`;
    }

    function drawChart() {
      const chartData = google.visualization.arrayToDataTable([
        ['Category', 'Amount'],
        ...transactions.map(t => [t.category, t.amount])
      ]);

      const options = {
        title: 'Transaction Breakdown',
        pieSliceText: 'value',
        slices: transactions.map((t, i) => t.category === 'Income' ? { color: '#ccc', visibleInLegend: true, offset: 0.1 } : null)
      };

      const chart = new google.visualization.PieChart(document.getElementById('piechart'));

      const view = new google.visualization.DataView(chartData);
      const filteredRows = chartData.getFilteredRows([{ column: 0, value: 'Income' }]);
      view.hideRows(filteredRows); // Hide Income by default

      chart.draw(view, options);

      // Filter dropdown
      const uniqueCategories = [...new Set(transactions.map(t => t.category))];
      const filter = document.getElementById('categoryFilter');
      uniqueCategories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        filter.appendChild(option);
      });

      filter.addEventListener('change', () => {
        const selected = filter.value;
        const filteredData = [['Category', 'Amount']];
        transactions.forEach(t => {
          if (!selected || t.category === selected) {
            filteredData.push([t.category, t.amount]);
          }
        });

        const newData = google.visualization.arrayToDataTable(filteredData);
        chart.draw(newData, options);
      });
    }

    function renderTable() {
      const tbody = document.querySelector('#transactionTable tbody');
      transactions.forEach(row => {
        const tr = document.createElement('tr');

        const formattedDate = formatDateString(row.date);

        tr.innerHTML = `
          <td>${formattedDate}</td>
          <td>${row.description}</td>
          <td>${row.category}</td>
          <td class="${getCategoryColor(row.category)}">Rs. ${row.amount}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    renderTable();
  </script>
</body>
</html>
