<!DOCTYPE html>
<html>
<head>
  <title>My Finance Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
    canvas { max-width: 600px; margin: 20px auto; }
  </style>
</head>
<body>

<h1>My Finance Summary</h1>
<canvas id="incomeExpenseChart"></canvas>
<canvas id="categoryBreakdown"></canvas>

<script>
  async function fetchSheetData() {
    // Add more published CSV URLs here
    const urls = [
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vR07b8P7SVR9ySREw_L4TLbuXO-jcRxZ6WzmdkCRvQT9kKuHrhvpHs5VKRRHgJ6RO0qZgdSFoc3dD-N/pub?output=csv"
    ];

    let rows = [];
    for (const url of urls) {
      const response = await fetch(url);
      const text = await response.text();
      const lines = text.split("\n").slice(1);
      for (const line of lines) {
        const parts = line.split(",");
        const category = parts[1]?.trim();
        const amount = parseFloat(parts[2]);
        if (!isNaN(amount)) {
          rows.push({ category, amount });
        }
      }
    }

    return rows;
  }

  function generateCharts(data) {
    let totalIncome = 0;
    let totalExpense = 0;
    let categoryMap = {};

    data.forEach(row => {
      if (row.category.toLowerCase().includes('income')) {
        totalIncome += row.amount;
      } else {
        totalExpense += row.amount;
        categoryMap[row.category] = (categoryMap[row.category] || 0) + row.amount;
      }
    });

    new Chart(document.getElementById('incomeExpenseChart'), {
      type: 'bar',
      data: {
        labels: ['Income', 'Expenses'],
        datasets: [{
          label: 'Amount',
          data: [totalIncome, totalExpense],
          backgroundColor: ['green', 'red']
        }]
      }
    });

    new Chart(document.getElementById('categoryBreakdown'), {
      type: 'pie',
      data: {
        labels: Object.keys(categoryMap),
        datasets: [{
          label: 'Expenses by Category',
          data: Object.values(categoryMap),
          backgroundColor: [
            '#e6194b','#3cb44b','#ffe119','#4363d8','#f58231','#911eb4','#46f0f0',
            '#f032e6','#bcf60c','#fabebe','#008080','#e6beff'
          ]
        }]
      }
    });
  }

  fetchSheetData().then(generateCharts);
</script>
</body>
</html>
